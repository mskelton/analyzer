name: Build
on: [push]
jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - uses: mskelton/setup-yarn@v1
      - run: yarn lint
      - run: yarn prettier --check .

  ts:
    name: TypeScript
    runs-on: ubuntu-latest
    steps:
      - uses: mskelton/setup-yarn@v1
      - run: yarn ts

  deploy-temp:
    name: Deploy to temp environment
    runs-on: ubuntu-latest
    needs: [lint, ts]
    steps:
      - uses: actions/checkout@v1
      - name: Deploy
        uses: ./.github/actions/deploy

  integ:
    name: Integration tests
    runs-on: ubuntu-latest
    needs: [deploy-temp]
    steps:
      - uses: mskelton/setup-yarn@v1
      - run: yarn test:integ

  e2e:
    name: End-to-end tests
    runs-on: ubuntu-latest
    needs: [deploy-temp]
    steps:
      - uses: mskelton/setup-yarn@v1
      - run: yarn test:e2e

  deploy-prod:
    name: Deploy to prod environment
    runs-on: ubuntu-latest
    needs: [integ, e2e]
    steps:
      - uses: actions/checkout@v1
      - name: Deploy
        uses: ./.github/actions/deploy
